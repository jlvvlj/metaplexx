{"ast":null,"code":"import { Duplex } from 'readable-stream';\nimport { randomId } from '@toruslabs/openlogin-utils';\nimport { EventEmitter } from 'events';\nimport stringify from 'fast-safe-stringify';\nimport eos from 'end-of-stream';\nimport once from 'once';\nimport pump from 'pump';\n\nfunction noop() {\n  return undefined;\n}\n\nconst SYN = \"SYN\";\nconst ACK = \"ACK\";\nconst BRK = \"BRK\";\n\nclass BasePostMessageStream extends Duplex {\n  constructor(_ref) {\n    let {\n      name,\n      target,\n      targetWindow = window,\n      targetOrigin = \"*\"\n    } = _ref;\n    super({\n      objectMode: true\n    });\n\n    if (!name || !target) {\n      throw new Error(\"Invalid input.\");\n    }\n\n    this._init = false;\n    this._haveSyn = false;\n    this._name = name;\n    this._target = target; // target origin\n\n    this._targetWindow = targetWindow;\n    this._targetOrigin = targetOrigin;\n    this._onMessage = this.onMessage.bind(this);\n    this._synIntervalId = null;\n    window.addEventListener(\"message\", this._onMessage, false);\n\n    this._handShake();\n  }\n\n  _break() {\n    this.cork();\n\n    this._write(BRK, null, noop);\n\n    this._haveSyn = false;\n    this._init = false;\n  }\n\n  _handShake() {\n    this._write(SYN, null, noop);\n\n    this.cork();\n  }\n\n  _onData(data) {\n    if (!this._init) {\n      // listen for handshake\n      if (data === SYN) {\n        this._haveSyn = true;\n\n        this._write(ACK, null, noop);\n      } else if (data === ACK) {\n        this._init = true;\n\n        if (!this._haveSyn) {\n          this._write(ACK, null, noop);\n        }\n\n        this.uncork();\n      }\n    } else if (data === BRK) {\n      this._break();\n    } else {\n      // forward message\n      try {\n        this.push(data);\n      } catch (err) {\n        this.emit(\"error\", err);\n      }\n    }\n  }\n\n  _postMessage(data) {\n    const originConstraint = this._targetOrigin;\n\n    this._targetWindow.postMessage({\n      target: this._target,\n      data\n    }, originConstraint);\n  }\n\n  onMessage(event) {\n    const message = event.data; // validate message\n\n    if (this._targetOrigin !== \"*\" && event.origin !== this._targetOrigin || event.source !== this._targetWindow || typeof message !== \"object\" || message.target !== this._name || !message.data) {\n      return;\n    }\n\n    this._onData(message.data);\n  }\n\n  _read() {\n    return undefined;\n  }\n\n  _write(data, _, cb) {\n    this._postMessage(data);\n\n    cb();\n  }\n\n  _destroy() {\n    window.removeEventListener(\"message\", this._onMessage, false);\n  }\n\n}\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\n\n\nfunction __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nfunction safeApply(handler, context, args) {\n  try {\n    Reflect.apply(handler, context, args);\n  } catch (err) {\n    // Throw error after timeout so as not to interrupt the stack\n    setTimeout(() => {\n      throw err;\n    });\n  }\n}\n\nfunction arrayClone(arr) {\n  const n = arr.length;\n  const copy = new Array(n);\n\n  for (let i = 0; i < n; i += 1) {\n    copy[i] = arr[i];\n  }\n\n  return copy;\n}\n\nclass SafeEventEmitter extends EventEmitter {\n  emit(type) {\n    let doError = type === \"error\";\n    const events = this._events;\n\n    if (events !== undefined) {\n      doError = doError && events.error === undefined;\n    } else if (!doError) {\n      return false;\n    } // If there is no 'error' event listener then throw.\n\n\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    if (doError) {\n      let er;\n\n      if (args.length > 0) {\n        [er] = args;\n      }\n\n      if (er instanceof Error) {\n        // Note: The comments on the `throw` lines are intentional, they show\n        // up in Node's output if this results in an unhandled exception.\n        throw er; // Unhandled 'error' event\n      } // At least give some kind of context to the user\n\n\n      const err = new Error(`Unhandled error.${er ? ` (${er.message})` : \"\"}`);\n      err.context = er;\n      throw err; // Unhandled 'error' event\n    }\n\n    const handler = events[type];\n\n    if (handler === undefined) {\n      return false;\n    }\n\n    if (typeof handler === \"function\") {\n      safeApply(handler, this, args);\n    } else {\n      const len = handler.length;\n      const listeners = arrayClone(handler);\n\n      for (let i = 0; i < len; i += 1) {\n        safeApply(listeners[i], this, args);\n      }\n    }\n\n    return true;\n  }\n\n}\n\nclass SerializableError extends Error {\n  constructor(_ref2) {\n    let {\n      code,\n      message,\n      data\n    } = _ref2;\n\n    if (!Number.isInteger(code)) {\n      throw new Error(\"code must be an integer\");\n    }\n\n    if (!message || typeof message !== \"string\") {\n      throw new Error(\"message must be string\");\n    }\n\n    super(message);\n    this.code = code;\n\n    if (data !== undefined) {\n      this.data = data;\n    }\n  }\n\n  toString() {\n    return stringify({\n      code: this.code,\n      message: this.message,\n      data: this.data,\n      stack: this.stack\n    });\n  }\n\n}\n\nfunction serializeError(error) {\n  return error.toString();\n}\n\nconst getRpcPromiseCallback = function (resolve, reject) {\n  let unwrapResult = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  return (error, response) => {\n    if (error || response.error) {\n      reject(error || response.error);\n    } else if (!unwrapResult || Array.isArray(response)) {\n      resolve(response);\n    } else {\n      resolve(response.result);\n    }\n  };\n};\n\nfunction createErrorMiddleware(log) {\n  return (req, res, next, end) => {\n    try {\n      // json-rpc-engine will terminate the request when it notices this error\n      if (typeof req.method !== \"string\" || !req.method) {\n        res.error = new SerializableError({\n          code: -32603,\n          message: \"invalid method\"\n        });\n        end();\n        return;\n      }\n\n      next(done => {\n        const {\n          error\n        } = res;\n\n        if (!error) {\n          return done();\n        }\n\n        log.error(`OpenLogin - RPC Error: ${error.message}`, error);\n        return done();\n      });\n    } catch (error) {\n      log.error(`OpenLogin - RPC Error thrown: ${error.message}`, error);\n      res.error = new SerializableError({\n        code: -32603,\n        message: error.message\n      });\n      end();\n    }\n  };\n}\n\nfunction createStreamMiddleware() {\n  const idMap = {};\n\n  function readNoop() {\n    return false;\n  }\n\n  const events = new SafeEventEmitter();\n\n  function processResponse(res) {\n    const context = idMap[res.id];\n\n    if (!context) {\n      throw new Error(`StreamMiddleware - Unknown response id \"${res.id}\"`);\n    }\n\n    delete idMap[res.id]; // copy whole res onto original res\n\n    Object.assign(context.res, res); // run callback on empty stack,\n    // prevent internal stream-handler from catching errors\n\n    setTimeout(context.end);\n  }\n\n  function processNotification(res) {\n    events.emit(\"notification\", res);\n  }\n\n  function processMessage(res, _encoding, cb) {\n    let err;\n\n    try {\n      const isNotification = !res.id;\n\n      if (isNotification) {\n        processNotification(res);\n      } else {\n        processResponse(res);\n      }\n    } catch (_err) {\n      err = _err;\n    } // continue processing stream\n\n\n    cb(err);\n  }\n\n  const stream = new Duplex({\n    objectMode: true,\n    read: readNoop,\n    write: processMessage\n  });\n\n  const middleware = (req, res, next, end) => {\n    // write req to stream\n    stream.push(req); // register request on id map\n\n    idMap[req.id] = {\n      req,\n      res,\n      next,\n      end\n    };\n  };\n\n  return {\n    events,\n    middleware,\n    stream\n  };\n}\n\nfunction createScaffoldMiddleware(handlers) {\n  return (req, res, next, end) => {\n    const handler = handlers[req.method]; // if no handler, return\n\n    if (handler === undefined) {\n      return next();\n    } // if handler is fn, call as middleware\n\n\n    if (typeof handler === \"function\") {\n      return handler(req, res, next, end);\n    } // if handler is some other value, use as result\n\n\n    res.result = handler;\n    return end();\n  };\n}\n\nfunction createIdRemapMiddleware() {\n  return (req, res, next, _end) => {\n    const originalId = req.id;\n    const newId = randomId();\n    req.id = newId;\n    res.id = newId;\n    next(done => {\n      req.id = originalId;\n      res.id = originalId;\n      done();\n    });\n  };\n}\n\nfunction createLoggerMiddleware(logger) {\n  return (req, res, next, _) => {\n    logger.debug(\"REQ\", req, \"RES\", res);\n    next();\n  };\n}\n\nfunction createAsyncMiddleware(asyncMiddleware) {\n  return (req, res, next, end) => __awaiter(this, void 0, void 0, function* () {\n    // nextPromise is the key to the implementation\n    // it is resolved by the return handler passed to the\n    // \"next\" function\n    let resolveNextPromise;\n    const nextPromise = new Promise(resolve => {\n      resolveNextPromise = resolve;\n    });\n    let returnHandlerCallback = null;\n    let nextWasCalled = false; // This will be called by the consumer's async middleware.\n\n    const asyncNext = () => __awaiter(this, void 0, void 0, function* () {\n      nextWasCalled = true; // We pass a return handler to next(). When it is called by the engine,\n      // the consumer's async middleware will resume executing.\n\n      next(runReturnHandlersCallback => {\n        // This callback comes from JRPCEngine._runReturnHandlers\n        returnHandlerCallback = runReturnHandlersCallback;\n        resolveNextPromise();\n      });\n      yield nextPromise;\n    });\n\n    try {\n      yield asyncMiddleware(req, res, asyncNext);\n\n      if (nextWasCalled) {\n        yield nextPromise; // we must wait until the return handler is called\n\n        returnHandlerCallback(null);\n      } else {\n        end(null);\n      }\n    } catch (error) {\n      if (returnHandlerCallback) {\n        returnHandlerCallback(error);\n      } else {\n        end(error);\n      }\n    }\n  });\n}\n/**\n * A JSON-RPC request and response processor.\n * Give it a stack of middleware, pass it requests, and get back responses.\n */\n\n\nclass JRPCEngine extends SafeEventEmitter {\n  constructor() {\n    super();\n    this._middleware = [];\n  }\n  /**\n   * Serially executes the given stack of middleware.\n   *\n   * @returns An array of any error encountered during middleware execution,\n   * a boolean indicating whether the request was completed, and an array of\n   * middleware-defined return handlers.\n   */\n\n\n  static _runAllMiddleware(req, res, middlewareStack) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const returnHandlers = [];\n      let error = null;\n      let isComplete = false; // Go down stack of middleware, call and collect optional returnHandlers\n\n      for (const middleware of middlewareStack) {\n        [error, isComplete] = yield JRPCEngine._runMiddleware(req, res, middleware, returnHandlers);\n\n        if (isComplete) {\n          break;\n        }\n      }\n\n      return [error, isComplete, returnHandlers.reverse()];\n    });\n  }\n  /**\n   * Runs an individual middleware.\n   *\n   * @returns An array of any error encountered during middleware exection,\n   * and a boolean indicating whether the request should end.\n   */\n\n\n  static _runMiddleware(req, res, middleware, returnHandlers) {\n    return new Promise(resolve => {\n      const end = err => {\n        const error = err || res.error;\n\n        if (error) {\n          res.error = serializeError(error);\n        } // True indicates that the request should end\n\n\n        resolve([error, true]);\n      };\n\n      const next = returnHandler => {\n        if (res.error) {\n          end(res.error);\n        } else {\n          if (returnHandler) {\n            if (typeof returnHandler !== \"function\") {\n              end(new SerializableError({\n                code: -32603,\n                message: \"JRPCEngine: 'next' return handlers must be functions\"\n              }));\n            }\n\n            returnHandlers.push(returnHandler);\n          } // False indicates that the request should not end\n\n\n          resolve([null, false]);\n        }\n      };\n\n      try {\n        middleware(req, res, next, end);\n      } catch (error) {\n        end(error);\n      }\n    });\n  }\n  /**\n   * Serially executes array of return handlers. The request and response are\n   * assumed to be in their scope.\n   */\n\n\n  static _runReturnHandlers(handlers) {\n    return __awaiter(this, void 0, void 0, function* () {\n      for (const handler of handlers) {\n        yield new Promise((resolve, reject) => {\n          handler(err => err ? reject(err) : resolve());\n        });\n      }\n    });\n  }\n  /**\n   * Throws an error if the response has neither a result nor an error, or if\n   * the \"isComplete\" flag is falsy.\n   */\n\n\n  static _checkForCompletion(req, res, isComplete) {\n    if (!(\"result\" in res) && !(\"error\" in res)) {\n      throw new SerializableError({\n        code: -32603,\n        message: \"Response has no error or result for request\"\n      });\n    }\n\n    if (!isComplete) {\n      throw new SerializableError({\n        code: -32603,\n        message: \"Nothing ended request\"\n      });\n    }\n  }\n  /**\n   * Add a middleware function to the engine's middleware stack.\n   *\n   * @param middleware - The middleware function to add.\n   */\n\n\n  push(middleware) {\n    this._middleware.push(middleware);\n  }\n\n  handle(req, cb) {\n    if (cb && typeof cb !== \"function\") {\n      throw new Error('\"callback\" must be a function if provided.');\n    }\n\n    if (Array.isArray(req)) {\n      if (cb) {\n        return this._handleBatch(req, cb);\n      }\n\n      return this._handleBatch(req);\n    }\n\n    if (cb) {\n      return this._handle(req, cb);\n    }\n\n    return this._promiseHandle(req);\n  }\n  /**\n   * Returns this engine as a middleware function that can be pushed to other\n   * engines.\n   *\n   * @returns This engine as a middleware function.\n   */\n\n\n  asMiddleware() {\n    return (req, res, next, end) => __awaiter(this, void 0, void 0, function* () {\n      try {\n        const [middlewareError, isComplete, returnHandlers] = yield JRPCEngine._runAllMiddleware(req, res, this._middleware);\n\n        if (isComplete) {\n          yield JRPCEngine._runReturnHandlers(returnHandlers);\n          return end(middlewareError);\n        }\n\n        return next(handlerCallback => __awaiter(this, void 0, void 0, function* () {\n          try {\n            yield JRPCEngine._runReturnHandlers(returnHandlers);\n          } catch (error) {\n            return handlerCallback(error);\n          }\n\n          return handlerCallback();\n        }));\n      } catch (error) {\n        return end(error);\n      }\n    });\n  }\n\n  _handleBatch(reqs, cb) {\n    return __awaiter(this, void 0, void 0, function* () {\n      // The order here is important\n      try {\n        // 2. Wait for all requests to finish, or throw on some kind of fatal\n        // error\n        const responses = yield Promise.all( // 1. Begin executing each request in the order received\n        reqs.map(this._promiseHandle.bind(this))); // 3. Return batch response\n\n        if (cb) {\n          return cb(null, responses);\n        }\n\n        return responses;\n      } catch (error) {\n        if (cb) {\n          return cb(error);\n        }\n\n        throw error;\n      }\n    });\n  }\n  /**\n   * A promise-wrapped _handle.\n   */\n\n\n  _promiseHandle(req) {\n    return new Promise(resolve => {\n      this._handle(req, (_err, res) => {\n        // There will always be a response, and it will always have any error\n        // that is caught and propagated.\n        resolve(res);\n      });\n    });\n  }\n  /**\n   * Ensures that the request object is valid, processes it, and passes any\n   * error and the response object to the given callback.\n   *\n   * Does not reject.\n   */\n\n\n  _handle(callerReq, cb) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!callerReq || Array.isArray(callerReq) || typeof callerReq !== \"object\") {\n        const error = new SerializableError({\n          code: -32603,\n          message: \"request must be plain object\"\n        });\n        return cb(error, {\n          id: undefined,\n          jsonrpc: \"2.0\",\n          error\n        });\n      }\n\n      if (typeof callerReq.method !== \"string\") {\n        const error = new SerializableError({\n          code: -32603,\n          message: \"method must be string\"\n        });\n        return cb(error, {\n          id: callerReq.id,\n          jsonrpc: \"2.0\",\n          error\n        });\n      }\n\n      const req = Object.assign({}, callerReq);\n      const res = {\n        id: req.id,\n        jsonrpc: req.jsonrpc\n      };\n      let error = null;\n\n      try {\n        yield this._processRequest(req, res);\n      } catch (_error) {\n        // A request handler error, a re-thrown middleware error, or something\n        // unexpected.\n        error = _error;\n      }\n\n      if (error) {\n        // Ensure no result is present on an errored response\n        delete res.result;\n\n        if (!res.error) {\n          res.error = serializeError(error);\n        }\n      }\n\n      return cb(error, res);\n    });\n  }\n  /**\n   * For the given request and response, runs all middleware and their return\n   * handlers, if any, and ensures that internal request processing semantics\n   * are satisfied.\n   */\n\n\n  _processRequest(req, res) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const [error, isComplete, returnHandlers] = yield JRPCEngine._runAllMiddleware(req, res, this._middleware); // Throw if \"end\" was not called, or if the response has neither a result\n      // nor an error.\n\n      JRPCEngine._checkForCompletion(req, res, isComplete); // The return handlers should run even if an error was encountered during\n      // middleware processing.\n\n\n      yield JRPCEngine._runReturnHandlers(returnHandlers); // Now we re-throw the middleware processing error, if any, to catch it\n      // further up the call chain.\n\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n}\n\nfunction mergeMiddleware(middlewareStack) {\n  const engine = new JRPCEngine();\n  middlewareStack.forEach(middleware => engine.push(middleware));\n  return engine.asMiddleware();\n}\n\nfunction createEngineStream(opts) {\n  if (!opts || !opts.engine) {\n    throw new Error(\"Missing engine parameter!\");\n  }\n\n  const {\n    engine\n  } = opts; // eslint-disable-next-line prefer-const\n\n  let stream;\n\n  function read() {\n    return undefined;\n  }\n\n  function write(req, _encoding, cb) {\n    engine.handle(req, (_err, res) => {\n      stream.push(res);\n    });\n    cb();\n  }\n\n  stream = new Duplex({\n    objectMode: true,\n    read,\n    write\n  }); // forward notifications\n\n  if (engine.on) {\n    engine.on(\"notification\", message => {\n      stream.push(message);\n    });\n  }\n\n  return stream;\n}\n\nclass Substream extends Duplex {\n  constructor(_ref3) {\n    let {\n      parent,\n      name\n    } = _ref3;\n    super({\n      objectMode: true\n    });\n    this._parent = parent;\n    this._name = name;\n  }\n  /**\n   * Explicitly sets read operations to a no-op.\n   */\n\n\n  _read() {\n    return undefined;\n  }\n  /**\n   * Called when data should be written to this writable stream.\n   *\n   * @param chunk - Arbitrary object to write\n   * @param encoding - Encoding to use when writing payload\n   * @param callback - Called when writing is complete or an error occurs\n   */\n\n\n  _write(chunk, _encoding, callback) {\n    this._parent.push({\n      name: this._name,\n      data: chunk\n    });\n\n    callback();\n  }\n\n}\n\nconst IGNORE_SUBSTREAM = Symbol(\"IGNORE_SUBSTREAM\");\n\nclass ObjectMultiplex extends Duplex {\n  constructor() {\n    let opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super(Object.assign(Object.assign({}, opts), {\n      objectMode: true\n    }));\n    this._substreams = {};\n  }\n\n  createStream(name) {\n    // validate name\n    if (!name) {\n      throw new Error(\"ObjectMultiplex - name must not be empty\");\n    }\n\n    if (this._substreams[name]) {\n      throw new Error(`ObjectMultiplex - Substream for name \"${name}\" already exists`);\n    } // create substream\n\n\n    const substream = new Substream({\n      parent: this,\n      name\n    });\n    this._substreams[name] = substream; // listen for parent stream to end\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n\n    anyStreamEnd(this, _error => substream.destroy(_error || undefined));\n    return substream;\n  } // ignore streams (dont display orphaned data warning)\n\n\n  ignoreStream(name) {\n    // validate name\n    if (!name) {\n      throw new Error(\"ObjectMultiplex - name must not be empty\");\n    }\n\n    if (this._substreams[name]) {\n      throw new Error(`ObjectMultiplex - Substream for name \"${name}\" already exists`);\n    } // set\n\n\n    this._substreams[name] = IGNORE_SUBSTREAM;\n  }\n\n  _read() {\n    return undefined;\n  }\n\n  _write(chunk, _encoding, callback) {\n    const {\n      name,\n      data\n    } = chunk;\n\n    if (!name) {\n      window.console.warn(`ObjectMultiplex - malformed chunk without name \"${chunk}\"`);\n      return callback();\n    } // get corresponding substream\n\n\n    const substream = this._substreams[name];\n\n    if (!substream) {\n      window.console.warn(`ObjectMultiplex - orphaned data for stream \"${name}\"`);\n      return callback();\n    } // push data into substream\n\n\n    if (substream !== IGNORE_SUBSTREAM) {\n      substream.push(data);\n    }\n\n    return callback();\n  }\n\n} // util\n\n\nfunction anyStreamEnd(stream, _cb) {\n  const cb = once(_cb);\n  eos(stream, {\n    readable: false\n  }, cb);\n  eos(stream, {\n    writable: false\n  }, cb);\n}\n\nfunction setupMultiplex(stream) {\n  const mux = new ObjectMultiplex();\n\n  mux.getStream = function streamHelper(name) {\n    if (this._substreams[name]) {\n      return this._substreams[name];\n    }\n\n    return this.createStream(name);\n  };\n\n  pump(stream, mux, stream, err => {\n    if (err) window.console.error(err);\n  });\n  return mux;\n}\n\nclass PostMessageStream extends BasePostMessageStream {\n  _postMessage(data) {\n    let originConstraint = this._targetOrigin;\n\n    if (typeof data === \"object\") {\n      const dataObj = data;\n\n      if (typeof dataObj.data === \"object\") {\n        const dataObjData = dataObj.data;\n\n        if (Array.isArray(dataObjData.params) && dataObjData.params.length > 0) {\n          const dataObjDataParam = dataObjData.params[0];\n\n          if (dataObjDataParam._origin) {\n            originConstraint = dataObjDataParam._origin;\n          } // add a constraint for the response\n\n\n          dataObjDataParam._origin = window.location.origin;\n        }\n      }\n    }\n\n    this._targetWindow.postMessage({\n      target: this._target,\n      data\n    }, originConstraint);\n  }\n\n}\n\nexport { BasePostMessageStream, IGNORE_SUBSTREAM, JRPCEngine, ObjectMultiplex, PostMessageStream, SafeEventEmitter, SerializableError, Substream, createAsyncMiddleware, createEngineStream, createErrorMiddleware, createIdRemapMiddleware, createLoggerMiddleware, createScaffoldMiddleware, createStreamMiddleware, getRpcPromiseCallback, mergeMiddleware, serializeError, setupMultiplex };","map":{"version":3,"mappings":"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","names":["noop","undefined","SYN","ACK","BRK","BasePostMessageStream","Duplex","constructor","name","target","targetWindow","window","targetOrigin","objectMode","Error","_init","_haveSyn","_name","_target","_targetWindow","_targetOrigin","_onMessage","onMessage","bind","_synIntervalId","addEventListener","_handShake","_break","cork","_write","_onData","data","uncork","push","err","emit","_postMessage","originConstraint","postMessage","event","message","origin","source","_read","_","cb","_destroy","removeEventListener","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","safeApply","handler","context","args","Reflect","setTimeout","arrayClone","arr","n","length","copy","Array","i","SafeEventEmitter","EventEmitter","type","doError","events","_events","error","er","len","listeners","SerializableError","code","Number","isInteger","toString","stringify","stack","serializeError","getRpcPromiseCallback","unwrapResult","response","isArray","createErrorMiddleware","log","req","res","end","method","createStreamMiddleware","idMap","readNoop","processResponse","id","Object","assign","processNotification","processMessage","_encoding","isNotification","_err","stream","read","write","middleware","createScaffoldMiddleware","handlers","createIdRemapMiddleware","_end","originalId","newId","randomId","createLoggerMiddleware","logger","debug","createAsyncMiddleware","asyncMiddleware","resolveNextPromise","nextPromise","returnHandlerCallback","nextWasCalled","asyncNext","runReturnHandlersCallback","JRPCEngine","_middleware","_runAllMiddleware","middlewareStack","returnHandlers","isComplete","_runMiddleware","reverse","returnHandler","_runReturnHandlers","_checkForCompletion","handle","_handleBatch","_handle","_promiseHandle","asMiddleware","middlewareError","handlerCallback","reqs","responses","all","map","callerReq","jsonrpc","_processRequest","_error","mergeMiddleware","engine","forEach","createEngineStream","opts","on","Substream","parent","_parent","chunk","callback","IGNORE_SUBSTREAM","Symbol","ObjectMultiplex","_substreams","createStream","substream","anyStreamEnd","destroy","ignoreStream","console","warn","_cb","once","eos","readable","writable","setupMultiplex","mux","getStream","streamHelper","pump","PostMessageStream","dataObj","dataObjData","params","dataObjDataParam","_origin","location"],"sources":["../src/basePostMessageStream.ts","../../../node_modules/tslib/tslib.es6.js","../src/safeEventEmitter.ts","../src/serializableError.ts","../src/jrpc.ts","../src/jrpcEngine.ts","../src/substream.ts","../src/mux.ts","../src/postMessageStream.ts"],"sourcesContent":[null,"/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n",null,null,null,null,null,null,null]},"metadata":{},"sourceType":"module"}